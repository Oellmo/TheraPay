name: Build Windows App

on:
  push:
    branches: [ "main" ] # Löst den Build bei einem Push auf den main-Branch aus
  workflow_dispatch: # Ermöglicht manuelles Starten des Workflows in der GitHub UI

jobs:
  build-windows:
    # Dieser Job läuft auf einer von GitHub bereitgestellten Windows-Maschine
    runs-on: windows-latest

    steps:
      # 1. Code aus dem Repository auschecken
      - name: Checkout repository
        uses: actions/checkout@v4

      # 2. Node.js einrichten (wird für den Neutralino-CLI benötigt)
      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      # 3. Den Neutralinojs-CLI global installieren
      - name: Install Neutralinojs CLI
        run: npm install -g @neutralinojs/neu

      # 4. Die Anwendung für die Veröffentlichung bauen (mit ausführlicher Ausgabe)
      - name: Build the application
        run: neu build --release --verbose

      # 5. (DEBUG) Inhalt des dist-Ordners auflisten
      - name: List files in build directory
        run: ls -R dist
        shell: pwsh # Stellt sicher, dass der Befehl in PowerShell ausgeführt wird

      # 6. (DEBUG) Das erstellte ZIP-Archiv entpacken und den Inhalt überprüfen
      - name: Unzip and verify artifact content
        shell: pwsh
        run: |
          Expand-Archive -Path dist/therapypay-app-release.zip -DestinationPath dist/unzipped -ErrorAction SilentlyContinue
          echo "--- Contents of the unzipped artifact: ---"
          ls -R dist/unzipped

      # 7. Die fertige ZIP-Datei als Artefakt hochladen
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: therapypay-app-windows
          path: dist/therapypay-app-release.zip
